<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>High Speed Vision System: tracking.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>tracking.cpp File Reference</h1>contains functions for tracking an object.  
<a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="fcdynamic_8h-source.html">fcdynamic.h</a>&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4c314e1407aa77e114b0191ecdc8f88a"></a><!-- doxytag: member="tracking.cpp::ROI_PAD" ref="4c314e1407aa77e114b0191ecdc8f88a" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8cpp.html#4c314e1407aa77e114b0191ecdc8f88a">ROI_PAD</a>&nbsp;&nbsp;&nbsp;35</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">padding applied after the blob's bounding box is found <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3282e2b335762053bc6941b768ea8b00"></a><!-- doxytag: member="tracking.cpp::PIXEL_BOUNDARY" ref="3282e2b335762053bc6941b768ea8b00" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>PIXEL_BOUNDARY</b>&nbsp;&nbsp;&nbsp;0xfffffffc</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8cpp.html#3eb2306c1de7f4323adb826bb00de6bd">set_roi_box</a> (<a class="el" href="structtracking__window.html">TrackingWindow</a> *win, int x, int y)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">sets the ROI to be centered around point [x, y] in the image's coordinate system.  <a href="#3eb2306c1de7f4323adb826bb00de6bd"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8cpp.html#d174d76a1eb7f9858d58bcba1a488d2e">fix_blob_bounds</a> (<a class="el" href="structtracking__window.html">TrackingWindow</a> *win)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">a helper function that converts the blob's initial position in the image coordinate system to the ROI coordinate system.  <a href="#d174d76a1eb7f9858d58bcba1a488d2e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8cpp.html#30c6456cd906143ef0875ce30f442514">set_region</a> (int e, int x, int y, int flags, void *param)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">an OpenCV mouse callback routine for the gui that sets the initial ROI locations and the initial blob bounding box.  <a href="#30c6456cd906143ef0875ce30f442514"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8cpp.html#e845914b924e19c1e6b62e4fd0104d82">pad_blob_region</a> (<a class="el" href="structtracking__window.html">TrackingWindow</a> *win)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">a helper routine to pad the tighter bounding box found by <code>blob</code>  <a href="#e845914b924e19c1e6b62e4fd0104d82"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8cpp.html#886618a390a59291ceef4ba14b2b1134">blob</a> (<a class="el" href="structtracking__window.html">TrackingWindow</a> *win)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">produces a tight rectangular bounding box around the object  <a href="#886618a390a59291ceef4ba14b2b1134"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="dc5da5ce16d857b2f8bad8dc42dc8bba"></a><!-- doxytag: member="tracking.cpp::desperate" ref="dc5da5ce16d857b2f8bad8dc42dc8bba" args="(TrackingWindow *win)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>desperate</b> (<a class="el" href="structtracking__window.html">TrackingWindow</a> *win)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="dbcb7160d5c9999c3472b32d94cd7802"></a><!-- doxytag: member="tracking.cpp::panic" ref="dbcb7160d5c9999c3472b32d94cd7802" args="(TrackingWindow *win)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>panic</b> (<a class="el" href="structtracking__window.html">TrackingWindow</a> *win)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="9166371627c3d5c15facd667f8ac5d03"></a><!-- doxytag: member="tracking.cpp::reposition" ref="9166371627c3d5c15facd667f8ac5d03" args="(TrackingWindow *ref, TrackingWindow *cur)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>reposition</b> (<a class="el" href="structtracking__window.html">TrackingWindow</a> *ref, <a class="el" href="structtracking__window.html">TrackingWindow</a> *cur)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="tracking_8cpp.html#9f461d4425fc7c3f0f1d582fcb650dd0">position</a> (<a class="el" href="structtracking__window.html">TrackingWindow</a> *cur)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">update the current TrackingWindow ROI for the next time it is active in the ROI sequence.  <a href="#9f461d4425fc7c3f0f1d582fcb650dd0"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
contains functions for tracking an object. 
<p>
in the documentation that follows keep in mind that in the TrackingWindow the ROI position parameters are with respect to the image reference frame (e.g. 0 &lt;= x &lt;= win-&gt;img_w) and the object parameters are relative to the ROI reference frame (e.g. 0 &lt;= x &lt;= win-&gt;roi_w). Also, object and blob are used interchangeably to mean the same thing, the entity being tracked by the vision system.<p>
also, instead of returning error values many functions use assertions to ensure certain cases never happen. If an assertion does trigger true, then there is probably a bug somewhere in the code; the functions prior to the function where the assertion failed were suppose to make sure that the assertion never occurred. The idea behind the assertion was to remove them after sufficient debugging was done. The assertions are still in the code, because they did not impact the speed of the system when timing tests were analyzed. They provide a small reassurance that there are no severe bugs in the function. <hr><h2>Function Documentation</h2>
<a class="anchor" name="886618a390a59291ceef4ba14b2b1134"></a><!-- doxytag: member="tracking.cpp::blob" ref="886618a390a59291ceef4ba14b2b1134" args="(TrackingWindow *win)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int blob           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtracking__window.html">TrackingWindow</a> *&nbsp;</td>
          <td class="paramname"> <em>win</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
produces a tight rectangular bounding box around the object 
<p>
<code>blob</code> finds an object in a given image as defined by the ROI and pixels in <code>win-&gt;img</code>. This current implementation is a simple bounding box algorithm that assumes the image has been binarized before it attempts to find a blob.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>win</em>&nbsp;</td><td>the TrackingWindow to update the location of the object based on the image data and the ROI</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>if an object is found then <code>OBJECT_FOUND</code>, else <code>!OBJECT_FOUND</code> </dd></dl>

</div>
</div><p>
<a class="anchor" name="d174d76a1eb7f9858d58bcba1a488d2e"></a><!-- doxytag: member="tracking.cpp::fix_blob_bounds" ref="d174d76a1eb7f9858d58bcba1a488d2e" args="(TrackingWindow *win)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fix_blob_bounds           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtracking__window.html">TrackingWindow</a> *&nbsp;</td>
          <td class="paramname"> <em>win</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
a helper function that converts the blob's initial position in the image coordinate system to the ROI coordinate system. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>win</em>&nbsp;</td><td>the TrackingWindow's ROI to fix.</td></tr>
  </table>
</dl>
<code>fix_blob_bounds</code> maps the blob's initial position to the ROI reference frame and it also fixes the bounds if the resulting points are outside the ROI window. 
</div>
</div><p>
<a class="anchor" name="e845914b924e19c1e6b62e4fd0104d82"></a><!-- doxytag: member="tracking.cpp::pad_blob_region" ref="e845914b924e19c1e6b62e4fd0104d82" args="(TrackingWindow *win)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pad_blob_region           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtracking__window.html">TrackingWindow</a> *&nbsp;</td>
          <td class="paramname"> <em>win</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
a helper routine to pad the tighter bounding box found by <code>blob</code> 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>win</em>&nbsp;</td><td>the TrackingWindow's blob parameters to pad.</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>the padding can be changed by modifying <code>ROI_PAD</code>. </dd></dl>

</div>
</div><p>
<a class="anchor" name="9f461d4425fc7c3f0f1d582fcb650dd0"></a><!-- doxytag: member="tracking.cpp::position" ref="9f461d4425fc7c3f0f1d582fcb650dd0" args="(TrackingWindow *cur)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int position           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtracking__window.html">TrackingWindow</a> *&nbsp;</td>
          <td class="paramname"> <em>cur</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
update the current TrackingWindow ROI for the next time it is active in the ROI sequence. 
<p>
<code>position</code> searches for the blob in an image and updates the TrackingWindow with the new blob and ROI positions for the next time the TrackingWindow is active.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cur</em>&nbsp;</td><td>the current TrackingWindow to update with new position information</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>if an object is found then <code>OBJECT_FOUND</code>, else <code>!OBJECT_FOUND</code></dd></dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>the current underlying algorithm calls <code>blob</code> to find the object and then calls <code>set_roi_box</code> to center the ROI around the center of the blob's bounding box. Careful modification of these two functions may improve the tracking capabilities of the vision system with more complex algorithms that still meet the desired timing constraints. </dd></dl>

</div>
</div><p>
<a class="anchor" name="30c6456cd906143ef0875ce30f442514"></a><!-- doxytag: member="tracking.cpp::set_region" ref="30c6456cd906143ef0875ce30f442514" args="(int e, int x, int y, int flags, void *param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_region           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>param</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
an OpenCV mouse callback routine for the gui that sets the initial ROI locations and the initial blob bounding box. 
<p>
<code>set_region</code> is used in the initialization of the system. The blob is in an unknown location and with the assistance of this function, the GUI shown (like in <a class="el" href="display__run_8cpp.html" title="visually shows the tracking algorithm and allows the use to manually set the initial...">display_run.cpp</a>) assists the user in setting the initial position of the object. Currently, dragging the left mouse button set the blob's parameters and pressing the right mouse button causes the ROI to be centered around that click. The function's prototype is specified in the OpenCV documentation. Go there for more details about callbacks in OpenCV<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>e</em>&nbsp;</td><td>the mouse event </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>the x coordinate of the click in the GUI reference frame (e.g. the image reference frame). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>y</em>&nbsp;</td><td>the y coordinate of the click </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>special keyboard modifier keys </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>param</em>&nbsp;</td><td>an optional parameter to pass into the routine. It is used to pass the current TrackingWindow.</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>there is an error between where the mouse is clicked in the GUI and the values reporting the position of the mouse click when this function is called. The visual feedback will be off and will require manual correction from the user by compensating with their mouse clicks. </dd></dl>

</div>
</div><p>
<a class="anchor" name="3eb2306c1de7f4323adb826bb00de6bd"></a><!-- doxytag: member="tracking.cpp::set_roi_box" ref="3eb2306c1de7f4323adb826bb00de6bd" args="(TrackingWindow *win, int x, int y)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_roi_box           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtracking__window.html">TrackingWindow</a> *&nbsp;</td>
          <td class="paramname"> <em>win</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>y</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
sets the ROI to be centered around point [x, y] in the image's coordinate system. 
<p>
<code>set_roi_box</code> centers a <code>TrackingWindow</code> ROI around [x, y] and updates the ROI in the system. It is still required to call <code>write_roi</code> in order for the frame grabber to receive the updated values.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>win</em>&nbsp;</td><td>the TrackingWindow containing the ROI to update </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>x</em>&nbsp;</td><td>the x value to center the ROI around (0 &lt;= x &lt;= win-&gt;img_w) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>y</em>&nbsp;</td><td>the y value to center the ROI around (0 &lt;= y &lt;= win-&gt;img_h)</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd><code>set_roi_box</code> will center around [x, y] such that the roi_x and roi_w are multiples of 4 and roi_w is greater than 8. The former is a documented limitation in the Silicon Software API and the latter has been determined through observation. If <code>win-&gt;roi_w</code> &lt;= 8, then the camera hangs and does not send back any more images. It has not been tested to see if this bug is only isolated to the one desktop this code was developed on.<p>
it is important to reiterate that the updated ROI returned by this functions is NOT written to the frame grabber. A call to <code>write_roi</code> is still required. </dd></dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Jan 29 21:50:49 2009 for High Speed Vision System by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
